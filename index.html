<html>
    <head>
        <meta charset="UTF-8">
        <title>비교내신 환산</title>
        <link rel="stylesheet" href="assets/css/index.css">
        <script type="text/javascript" src="assets/js/jquery-3.5.1.min.js"></script>
    </head>
    <body>
		<img id="limit-img" src="assets/img/test.jpg"/>
		<div class="main-contents">
			<header>
				<div class="header-top">
					<a href="index.html"><img src="assets/img/logo/마이유니-타이포-버전.png" class="logo-img"/></a>
				</div>
				<nav class="contents">
					<ul>
						<li><a href="index.html">비교내신 환산</a></li>
						<li><a href="consulting.html">진학 컨설팅</a></li>
						<li><a href="education.html">대학 입시 소양교육</a></li>
					</ul>
				</nav>
            </header>
			<div class="div-top div1">
                <form class="score-form" id="abcd" method="GET">
                    <div class="div1-3 box">
                        <h1 class="box-title">반영과목 및 비율 선택</h1>
                        <div class="sub-form">
                            <input type="radio" name="status" id="1" value="0"/><label for="1">전과목</label>
                            <!-- <input type="radio" name="status" id="2" value="1"/><label for="2">필수과목(국/영/수/사/과/한)</label><br>
                            <input type="radio" name="status" id="3" value="2"/><label for="3">국/영/수 가중 반영</label>
                            <input type="radio" name="status" id="4" value="3"/><label for="4">상위</label> -->
                            <div style="font-size: 1.5rem; padding-left: 50px; color:rgb(125, 125, 125)">전과목 꼭 체크해주세요.</div>
                        </div>
                    </div>
                    <div class="div1-4 initial box">
                        <h1 class="box-title">성적 입력</h1>
                        <button class="svg-btn" id="input-btn" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#707070"><g data-name="Layer 2"><g data-name="edit"><rect width="24" height="24" opacity="0"/><path d="M19.4 7.34L16.66 4.6A2 2 0 0 0 14 4.53l-9 9a2 2 0 0 0-.57 1.21L4 18.91a1 1 0 0 0 .29.8A1 1 0 0 0 5 20h.09l4.17-.38a2 2 0 0 0 1.21-.57l9-9a1.92 1.92 0 0 0-.07-2.71zM9.08 17.62l-3 .28.27-3L12 9.32l2.7 2.7zM16 10.68L13.32 8l1.95-2L18 8.73z"/></g></g></svg></button>
                        <div id="subject-box">
                            <div class="score-form-box">
                                <p class="score-input"><label for="korean">국어</label><input type="text" name="korean" id="korean"/></p>
                                <p class="score-input"><label for="english">영어</label><input type="text" name="english" id="english"/></p>
                                <p class="score-input"><label for="math">수학</label><input type="text" name="math" id="math"/></p>
                                <p class="score-input"><label for="society">사회</label><input type="text" name="society" id="society"/></p>
                                <p class="score-input"><label for="science">과학</label><input type="text" name="science" id="science"/></p>
                                <p class="score-input"><label for="history">한국사</label><input type="text" name="history" id="history"/></p>
                                <p class="score-input"><label for="choice">선택</label><input type="text" name="choice" id="choice"/></p>
                            </div>
                            <button class="score-submit" id="sendbutton">환산하기</button>
                        </div>
                    </div>
                </form>
				<div class="div1-5 box" id="result-box">
                    <h1 class="box-title">환산 결과</h1>
                    <div class="filter">
                        <div>
                            <button class="svg-btn" id="find-btn" type="button"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="24pt" height="24pt" viewBox="0 0 24 24" version="1.1">
                                <g id="surface6025373">
                                <path style=" stroke:none;fill-rule:nonzero;fill:rgb(43.921569%,43.921569%,43.921569%);fill-opacity:1;" d="M 13.261719 14.867188 L 15.742188 17.347656 C 15.363281 18.070312 15.324219 18.789062 15.722656 19.1875 L 20.25 23.714844 C 20.820312 24.285156 22.0625 23.972656 23.015625 23.015625 C 23.972656 22.058594 24.285156 20.820312 23.714844 20.25 L 19.191406 15.722656 C 18.789062 15.324219 18.070312 15.363281 17.347656 15.738281 L 14.867188 13.261719 Z M 8.5 0 C 3.804688 0 0 3.804688 0 8.5 C 0 13.195312 3.804688 17 8.5 17 C 13.195312 17 17 13.195312 17 8.5 C 17 3.804688 13.195312 0 8.5 0 Z M 8.5 15 C 4.910156 15 2 12.089844 2 8.5 C 2 4.910156 4.910156 2 8.5 2 C 12.089844 2 15 4.910156 15 8.5 C 15 12.089844 12.089844 15 8.5 15 Z M 8.5 15 "/>
                                </g>
                                </svg></button>
                            <form class="uni-name-form">
                                <input type="text" name="uni" id="keyword" placeholder="대학명으로 검색해보세요"/>
                            </form>
                        </div>
                        <button class="svg-btn" id="filter-btn" type="button"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#707070"><g data-name="Layer 2"><g data-name="options-2"><rect width="24" height="24" transform="rotate(90 12 12)" opacity="0"/><path d="M19 9a3 3 0 0 0-2.82 2H3a1 1 0 0 0 0 2h13.18A3 3 0 1 0 19 9zm0 4a1 1 0 1 1 1-1 1 1 0 0 1-1 1z"/><path d="M3 7h1.18a3 3 0 0 0 5.64 0H21a1 1 0 0 0 0-2H9.82a3 3 0 0 0-5.64 0H3a1 1 0 0 0 0 2zm4-2a1 1 0 1 1-1 1 1 1 0 0 1 1-1z"/><path d="M21 17h-7.18a3 3 0 0 0-5.64 0H3a1 1 0 0 0 0 2h5.18a3 3 0 0 0 5.64 0H21a1 1 0 0 0 0-2zm-10 2a1 1 0 1 1 1-1 1 1 0 0 1-1 1z"/></g></g></svg></button>
                    </div>
                    <div class="div1-2">
                        <nav class="contents" id="filter-nav">
                            <ul>
                                <li><a href="#">가나다순</a></li>
                                <li><a href="#">등급 내림차순</a></li>
                                <li><a href="#">등급 오름차순</a></li>
                            </ul>
                        </nav>
                    </div>
                    <div style="height: 565px; margin: 35px 0;">
                        <table class="result-table convert-table">
                            <thead>
                                <tr>
                                    <th>대학명</th>
                                    <th>지역</th>
                                    <th>내신 환산</th>
                                    <th>과별 입결</th>
                                </tr>
                            </thead>
                            <tbody id="resultTbody">

                            </tbody>
                            <!-- js로 tbody 넘어옴 -->
                        </table>
                    </div>
                    <div class="move-table">
                        <button class="svg-btn" id="move-l-btn">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#707070"><g data-name="Layer 2"><g data-name="arrow-ios-back"><rect width="24" height="24" transform="rotate(90 12 12)" opacity="0"/><path d="M13.83 19a1 1 0 0 1-.78-.37l-4.83-6a1 1 0 0 1 0-1.27l5-6a1 1 0 0 1 1.54 1.28L10.29 12l4.32 5.36a1 1 0 0 1-.78 1.64z"/></g></g></svg>
                            <p>이전</p>
                        </button>
                        <button class="svg-btn" id="move-r-btn">
                            <p>다음</p>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="#707070"><g data-name="Layer 2"><g data-name="arrow-ios-forward"><rect width="24" height="24" transform="rotate(-90 12 12)" opacity="0"/><path d="M10 19a1 1 0 0 1-.64-.23 1 1 0 0 1-.13-1.41L13.71 12 9.39 6.63a1 1 0 0 1 .15-1.41 1 1 0 0 1 1.46.15l4.83 6a1 1 0 0 1 0 1.27l-5 6A1 1 0 0 1 10 19z"/></g></g></svg>
                        </button>
                    </div>
                    <div class="extra-box">
                        * 예체능계열의 환산 결과와는 다를 수 있습니다.
                    </div>
                    <div class="extra-box" style="margin-bottom: 40px;">
                        * 비교내신 등급환산 프로그램은 지원자의 등급계산 및 예전년도 성적자료와의 비교를 돕기 위한 단순 참고용이며, 실제 성적반영은 각 전형별 만점기준에 따른 환산 점수로 반영됩니다.
                    </div>
                </div>
			</div>
        </div>
        <div id="error-window">
            <p id="close-btn">X</p>
            <p class="message">서버가 점검 중입니다.</p>
        </div>
        <script type="text/javascript">
			$('#input-btn').click(function(){
				var display = $('#subject-box').css('display');
				console.log(display);
                if (display=='none'){
                    $('#subject-box').css('display', 'block');
                }else if(display == 'block'){
                    $('#subject-box').css('display', 'none');
                }
            })

            $('#filter-btn').click(function(){
                if($('#filter-nav').css('display') == "none"){
                    $('#filter-nav').css('display', 'block');
                }else{
                    $('#filter-nav').css('display', 'none');
                }
            })

            function showTable(){
                $('.resultTr1').css('display', 'table-row');
                $('.result-table').attr('id', '1');
            }

            $("#sendbutton").click(function (event) {
				$('#abcd').submit(function(event){
					event.preventDefault();
					$.ajax({
                        crossOrigin : true,
                        url: 'https://hellomyuni.kr/api/converter/each_converter',
                        type: "GET",
                        dataType: "json",
                        jsonp: false,
                        headers: {
                            'Content-Type' : "application/json",
                            'Access-Control-Allow-Credentials' : true,
                            'Access-Control-Allow-Origin':'*',
                            //'Access-Control-Allow-Methods':'GET',
                            //'Access-Control-Allow-Headers':'application/json',
                        },
                        data: {
                            status : "0",
                            korean: $('input[name=korean]').val(),
                            english: $('input[name=english]').val(),
                            math: $('input[name=math]').val(),
                            society: $('input[name=society]').val(),
                            science: $('input[name=science]').val(),
                            history: $('input[name=history]').val(),
                            choice: $('input[name=choice]').val(),
                        },
				        success: function( data ) {
                            $('input[name=korean]').val("");
                            $('input[name=english]').val("");
                            $('input[name=math]').val("");
                            $('input[name=society]').val("");
                            $('input[name=science]').val("");
                            $('input[name=history]').val("");
                            $('input[name=choice]').val("");
                            $('#subject-box').css('display', 'none');
                            $('#result-box').css('display', 'block');
                            $('#resultTbody').empty();

                            var fullData = [];

                            $.each(data.result, function(index, value){
                                $.each(value, function(index, each_val){
                                    fullData.push(each_val);
                                })
                            })
                            
                            var trIndex = 1;
                            $.each(fullData, function(index, value){
                                var tmpData = '<tr class= "resultTr resultTr'+trIndex+'">\
                                                    <td class="university">'+value.university+'</td>\
                                                    <td class="rest">'+value.area+'</td>';
                                                    
                                if(value.converted){
                                    tmpData += '<td class="rest">'+String(value.converted).slice(0,4)+'</td>';
                                }else{
                                    tmpData += '<td class="rest">'+" "+'</td>';
                                }
                                if(value.link){
                                    tmpData += '<td class="rest"><a class="link-btn" href="'+value.link+'"><img src="../assets/img/이미지 16_2020-08-11/이미지 16.png" class="-\31 6"/></a></td>'
                                }                               
                                tmpData += '</tr>';

                                $('#resultTbody').append(tmpData);
                                
                                if((index+1)%10 == 0){
                                    trIndex += 1;
                                }
                            })

                            showTable();
                        },
                        error:function(request,status,error){
                            $('#error-window').css('display', 'block');
                            console.log("status:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                        },
                        complete: function(data){
                            console.log(data);
                        }
                    })
		})
            })

            $('#close-btn').click(function(){
                $('#error-window').css('show', 'none');
            })

            // 대학명 검색필터 구현
            $("#keyword").keyup(function() {
                var k = $(this).val();
                $(".convert-table > tbody > tr").hide();
                var temp = $(".convert-table > tbody > tr > td:nth-child(5n+1):contains('" + k + "')");

                console.log(temp);

                $(temp).parent().show();
            })

            //다음버튼 구현
            $('#move-r-btn').click(function(){
                var result = $('.result-table').attr('id');
                var next_result = Number(result)+1;
                if($('.resultTr'+next_result).length != 0){
                    $('.resultTr').css('display', 'none');
                    $('.resultTr'+next_result).css('display', 'table-row');
                    $('.result-table').attr('id', String(next_result));
                }
            })

            //이전버튼 구현
            $('#move-l-btn').click(function(){
                var result = $('.result-table').attr('id');
                var before_result = Number(result)-1;
                if($('.resultTr'+before_result).length != 0){
                    $('.resultTr').css('display', 'none');
                    $('.resultTr'+before_result).css('display', 'table-row');
                    $('.result-table').attr('id', String(before_result));
                }
            })
		</script>
    </body>
</html>
